<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ماڵەوە | KURD CINEMA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --red: #e50914; }
        body { background: #080808; color: white; font-family: sans-serif; margin: 0; }
        header { padding: 15px 5%; background: #000; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--red); position: sticky; top: 0; z-index: 100; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; padding: 25px 5%; }
        .card { background: #111; border-radius: 12px; overflow: hidden; border: 1px solid #222; transition: 0.3s; }
        .card:hover { transform: scale(1.05); border-color: var(--red); }
        .card img { width: 100%; height: 240px; object-fit: cover; }
        .card-body { padding: 12px; text-align: center; }
        .btn { background: var(--red); color: white; text-decoration: none; padding: 8px 15px; border-radius: 5px; display: inline-block; font-weight: bold; }
        .logout { background: none; border: 1px solid #444; color: #888; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div style="color:var(--red); font-size: 24px; font-weight: bold;">KURD CINEMA</div>
    <button class="logout" onclick="signOut()">دەرچوون</button>
</header>

<div class="grid" id="movieList">باردەکرێت...</div>

<script>
    const S_URL = "https://lmizgmumuyflihplzkda.supabase.co";
    const S_KEY = "sb_publishable_k5vAoL2L0OkjhmGOpCB9wA_5GOaLRct";
    const supabase = supabase.createClient(S_URL, S_KEY);

    async function checkAuth() {
        const { data: { user } } = await supabase.auth.getUser();
        if (!user) { window.location.href = "login.html"; }
        else { loadMovies(); }
    }

    async function loadMovies() {
        const { data: movies, error } = await supabase.from('movies').select('*');
        const list = document.getElementById('movieList');
        list.innerHTML = "";
        if (movies) {
            movies.forEach(m => {
                list.innerHTML += `
                    <div class="card">
                        <img src="${m.image_url}">
                        <div class="card-body">
                            <h3 style="font-size:16px; margin-bottom:10px;">${m.title}</h3>
                            <a href="player.html?id=${m.id}" class="btn">تەماشا بکە</a>
                        </div>
                    </div>`;
            });
        }
    }

    async function signOut() { await supabase.auth.signOut(); window.location.href = "login.html"; }
    checkAuth();
</script>
</body>
</html>
